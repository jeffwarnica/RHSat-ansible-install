- name: "config content views | Create or update content views"
  theforeman.foreman.content_view:
    username: "{{ satellite_admin_username }}"
    password: "{{ satellite_admin_password }}"
    server_url: "{{ satellite_server_url }}"
    name: "{{ item.name }}"
    organization: "{{ satellite_organization }}"
    repositories:
      - name: "Red Hat Ansible Engine 2.8 RPMs for Red Hat Enterprise Linux 7 Server x86_64"
        product: "Red Hat Ansible Engine"
      - name: "Red Hat Software Collections RPMs for Red Hat Enterprise Linux 7 Server x86_64 7Server"
        product: "Red Hat Software Collections (for RHEL Server)"
      - name: "Red Hat Satellite Capsule 6.7 for RHEL 7 Server RPMs x86_64"
        product: "Red Hat Satellite Capsule"
      - name: "Red Hat Enterprise Linux 7 Server RPMs x86_64 7Server"
        product: "Red Hat Enterprise Linux Server"
      - name: "Red Hat Satellite Maintenance 6 for RHEL 7 Server RPMs x86_64"
        product: "Red Hat Enterprise Linux Server"
      - name: "Red Hat Satellite Tools 6.7 for RHEL 7 Server RPMs x86_64"
        product: "Red Hat Enterprise Linux Server"
  with_items: "{{ satellite_content_views }}"
  notify: handler - publish content views

- meta: flush_handlers

- name: "config content views | Create a composite content view"
  theforeman.foreman.content_view:
    username: "{{ satellite_admin_username }}"
    password: "{{ satellite_admin_password }}"
    server_url: "{{ satellite_server_url }}"
    name: "{{ item.name }}"
    organization: "{{ satellite_organization }}"
    composite: true
    auto_publish: true
    components: "{{ item.components }}"
  with_items: "{{ satellite_composite_content_views }}"
  notify: handler - publish composite content views
  when: satellite_composite_content_views is defined

- meta: flush_handlers
